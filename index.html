<!doctype html>
<!--
Created using JS Bin
http://jsbin.com

Copyright (c) 2025 by nayeon9759 (http://jsbin.com/xotodom/6/edit)

Released under the MIT license: http://jsbin.mit-license.org
-->
<meta name="robots" content="noindex">
<html lang="ko">
<head>
 <meta charset="utf-8" />
 <meta name="viewport" content="width=device-width,initial-scale=1" />
 <title>반려동물 긴급케어 설문</title>
 <link rel="stylesheet" href="styles.css">
 <style id="jsbin-css">
/* 기존 디자인 그대로 유지 */
:root{
 --bg:#0f1724;
 --primary:#ff4d4f; /* 메인 색상: 붉은 계열 */
 --accent:#ff9f43; /* 강조 색상: 주황 계열 */
 --card:#1f2a38; /* 카드 배경색 */
 --muted:#b9c0d7;
 --text-main: #e6eef8; /* 명확한 메인 텍스트 색상 */
 --highlight: #2c3a50; /* 결과 카드 하이라이트 배경색 */
 --scrollbar-track: #1f2a38;
 --scrollbar-thumb: #455263;
}

*{box-sizing:border-box}
/* body에 기본 배경과 텍스트 색상 강제 적용 */
body{
  margin:0;
  font-family: "Noto Sans KR", sans-serif;
  background:var(--bg);
  color:var(--text-main);
  padding:20px;
}
.wrap{max-width:900px;margin:0 auto;border-radius:12px;background:var(--card);padding:16px;box-shadow:0 6px 20px rgba(0,0,0,0.5);}

/* HERO */
.hero{padding:16px 20px;border-bottom:1px solid rgba(255,255,255,0.1)}
.hero-inner h1{margin:0;color:var(--primary)}
.lead{margin:4px 0 0;color:var(--muted);font-size:14px}

/* TABS */
.tabs{display:flex; gap:6px; margin:12px 0;}
.tab-btn{flex:1;padding:8px 10px;border-radius:8px;background:var(--card);border:1px solid rgba(255,255,255,0.1);color:var(--muted);cursor:pointer;transition:0.2s}
.tab-btn.active{background:var(--primary);color:white;box-shadow:0 4px 12px rgba(255,77,79,0.4);}

/* submissions */
.submissions-list{
 margin-top:12px;
 display:grid;
 gap:10px;
 max-height:450px;
 overflow-y:auto;
 padding-right:10px;
}

/* ⭐️ 스크롤바 스타일링 */
.submissions-list::-webkit-scrollbar {
  width: 8px;
}
.submissions-list::-webkit-scrollbar-track {
  background: var(--scrollbar-track);
  border-radius: 10px;
}
.submissions-list::-webkit-scrollbar-thumb {
  background-color: var(--primary); /* 스크롤 핸들 색상을 Primary로 변경하여 간지 강조 */
  border-radius: 10px;
  border: 2px solid var(--scrollbar-track);
}

/* ⭐️ 제출 결과 카드 디자인 (더욱 간결하고 강조되게 수정) */
.record {
  background: var(--highlight);
  padding: 12px;
  border-radius: 8px;
  border: 1px solid rgba(255, 77, 79, 0.2); /* 은은한 테두리 강조 */
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); /* 그림자 강조 */
  font-size: 14px;
}
.record-item {
  padding: 6px 0; /* 패딩 증가 */
  border-bottom: 1px solid rgba(255, 255, 255, 0.1); /* 항목별 구분선 강조 */
  display: flex;
  justify-content: space-between;
  align-items: center; /* 텍스트가 한 줄일 경우 중앙 정렬 */
}
.record-item strong {
  color: var(--accent); /* 레이블 색상 강조 (주황색) */
  font-weight: 700;
  margin-right: 15px;
  flex-shrink: 0;
}
.record-item span {
  text-align: right;
  flex-grow: 1;
  color: var(--text-main);
  font-weight: 500;
}
.record-item:last-child {
  border-bottom: none;
  padding-bottom: 0;
}

/* ⭐️ 등장 애니메이션 효과 (Fade-in-Up) */
@keyframes fadeInUp {
 from {
  opacity: 0;
  transform: translateY(10px);
 }
 to {
  opacity: 1;
  transform: translateY(0);
 }
}
.record.fade-in {
  opacity: 0;
  animation: fadeInUp 0.4s ease-out forwards;
  animation-delay: var(--delay, 0s); /* JS에서 설정할 딜레이 변수 */
}


/* PANELS */
.panel{display:none;padding:12px 0}
.panel.active{display:block}
.form-card{
  background:rgba(255,255,255,0.05);
  padding:12px;
  margin-bottom:30px;
  border-radius:8px;
  border:1px solid rgba(255,255,255,0.1)
}
/* 질문 텍스트 아래 간격 유지 */
.q{font-weight:700;margin-bottom:15px}
.required{color:var(--primary)}

.options.inline label{margin-right:16px}
.options.grid{display:grid;grid-template-columns:1fr 1fr;gap:6px}
.options label{display:flex;align-items:center;padding:8px;border-radius:6px;background:rgba(255,255,255,0.02);cursor:pointer;transition:0.2s}
.options input{margin-right:6px}

/* 입력 필드 색상 명확화 */
select,textarea,input[type="text"]{
  width:100%;
  padding:8px;
  border-radius:6px;
  background:rgba(255,255,255,0.03);
  border:1px solid rgba(255,255,255,0.1);
  color:var(--text-main);
  font-size:14px;
}

/* Buttons */
.btn{padding:8px 12px;border-radius:6px;font-weight:700;cursor:pointer;border:none;transition:0.2s}
.btn.primary{background:var(--primary);color:white;box-shadow:0 4px 12px rgba(255,77,79,0.4);}
.btn.primary:hover{transform:scale(1.05)}
.btn.ghost{background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.1);}
.btn.small{padding:4px 8px;font-size:12px}

/* guide */
.guide-card{padding:10px;background:rgba(255,255,255,0.01);border-radius:6px;border:1px solid rgba(255,255,255,0.1)}

/* footer */
.footer{margin-top:12px;text-align:center;font-size:12px;color:var(--muted)}

/* YouTube 영상 섹션 */
.video-guide{
 margin-top: 20px;
 padding: 16px;
 background: rgba(255, 77, 79, 0.05);
 border-radius: 8px;
 border: 1px solid var(--primary);
}
.guide-title{
 font-size: 16px;
 color: var(--primary);
 margin-top: 0;
 margin-bottom: 12px;
 font-weight: 700;
}
.video-container{
 position: relative;
 width: 100%;
 padding-bottom: 50%;
 height: 0;
 overflow: hidden;
 border-radius: 6px;
}
.video-container iframe{
 position: absolute;
 top: 0;
 left: 0;
 width: 100%;
 height: 100%;
}
.video-caption{
 font-size: 13px;
 color: var(--muted);
 margin-top: 10px;
 text-align: center;
}

/* 차트 관련 스타일은 제거됨 */
.charts h4{display: none;}
.charts canvas{display: none;}


@media(max-width:640px){.options.grid{grid-template-columns:1fr}}
</style>
</head>
<body>
 <main class="wrap">
  <header class="hero">
   <div class="hero-inner">
    <h1>🐾 SOS! 24시 동물병원 </h1>
    <p class="lead">응급 상황—우리 서비스가 진짜 도움이 되도록, 솔직한 의견을 들려주세요.</p>
   </div>
  </header>

  <nav class="tabs">
   <button class="tab-btn active" data-target="survey">설문 참여</button>
   <button class="tab-btn" data-target="guide">설문 안내</button>
   <button class="tab-btn" data-target="submissions">다른 사람 의견 보기</button>
  </nav>

    <section id="survey" class="tab-panel active panel">
   <form id="petSurveyForm" class="survey-form" autocomplete="off">
        <div class="form-card">
     <label class="q">1. 반려동물 양육 경험이 있으십니까? <span class="required">*</span></label>
     <div class="options inline">
      <label><input type="radio" name="hasPet" value="예" required> 예</label>
      <label><input type="radio" name="hasPet" value="아니오"> 아니오</label>
     </div>
    </div>

        <div class="form-card">
     <label class="q">2. 당신이 사는 지역은 어디인가요?</label>
     <div class="options">
      <label><input type="radio" name="region" value="서울"> 서울</label>
      <label><input type="radio" name="region" value="경기도"> 경기도</label>
      <label><input type="radio" name="region" value="경상도"> 경상도</label>
      <label><input type="radio" name="region" value="기타"> 기타</label>
      <input type="text" name="regionOther" placeholder="직접 입력" style="display:none;">
     </div>
    </div>

        <div class="form-card">
     <label class="q">3. 평소 동물병원 선택 시 가장 우선시하는 기준은 무엇인가요? <span class="required">*</span></label>
     <select name="priorityCriteria" required>
      <option value="">선택하세요</option>
      <option value="비용">비용</option>
      <option value="직원의 친절도">직원의 친절도</option>
      <option value="거리">거리</option>
      <option value="병원의 평판">병원의 평판</option>
      <option value="의료진의 전문성 및 경험">의료진의 전문성 및 경험</option>
     </select>
    </div>

        <div class="form-card">
     <label class="q">4. 응급 상황에서 우려되는 점과, 필요한 서비스 기능은 무엇인가요?” <span class="required">*</span></label>
     <textarea name="concernAndFeature" rows="5" placeholder="예: 야간 응급비용이 불투명 → 가격 투명성 & 예상비용 계산 기능" required></textarea>
    </div>

        <div class="form-card">
     <label class="q">5. 응급 상황 시 병원 정보에서 '가장 중요한 정보(1순위)'와 '두 번째로 중요한 정보(2순위)'를 선택해주세요. <span class="required">*</span></label>
     <div class="priority-grid">
      <div>
       <label class="small">1순위</label>
       <select name="priority1" required>
        <option value="">선택</option>
        <option value="현재 운영 여부">A. 현재 운영 여부</option>
        <option value="주차 가능 여부">B. 주차 가능 여부</option>
        <option value="주요 진료 과목">C. 주요 진료 과목</option>
       </select>
      </div>
      <div>
       <label class="small">2순위</label>
       <select name="priority2" required>
        <option value="">선택</option>
        <option value="현재 운영 여부">A. 현재 운영 여부</option>
        <option value="주차 가능 여부">B. 주차 가능 여부</option>
        <option value="주요 진료 과목">C. 주요 진료 과목</option>
       </select>
      </div>
     </div>
    </div>

        <div class="form-card">
     <label class="q">6. 반려동물 응급 시 최대 지불 의향 금액 범위는? <span class="required">*</span></label>
     <div class="options grid">
      <label><input type="radio" name="priceRange" value="50만원 미만" required> A. 50만원 미만</label>
      <label><input type="radio" name="priceRange" value="50만원 ~ 100만원"> B. 50만원 ~ 100만원</label>
      <label><input type="radio" name="priceRange" value="100만원 ~ 200만원"> C. 100만원 ~ 200만원</label>
      <label><input type="radio" name="priceRange" value="200만원 이상"> D. 200만원 이상</label>
     </div>
    </div>

    <div class="form-actions">
     <button type="submit" class="btn primary">제출하기</button>
     <button type="reset" class="btn ghost">초기화</button>
    </div>

    <div id="msg" class="msg" aria-live="polite"></div>
   </form>
  </section>

    <section id="guide" class="tab-panel panel">
   <article class="guide-card">
  <h3>설문 안내 및 참여 대상</h3>
  <p>이 설문조사는 반려동물을 현재 키우고 계시거나, 과거 양육 경험이 있으신 분들의 소중한 의견을 듣기 위해 기획되었습니다.</p>
  <p>혹시라도 위 조건에 해당하지 않으시는 분들은 번거로우시겠지만, 정확한 데이터 분석을 위해 지금 설문을 종료해 주시면 정말로 감사하겠습니다.</p>  
  <p>참여해 주셔서 감사합니다!</p>
</article>
  </section>

    <section id="submissions" class="tab-panel panel">
   <div class="panel-head">
    <h3>최근 제출된 의견</h3>
   </div>
   <div id="submissionsList" class="submissions-list">
    <div class="placeholder">아직 제출된 기록이 없습니다.</div>
   </div>

      <div class="video-guide">
    <h4 class="guide-title">🚨 응급 상황! 대처법 안내 (참고 영상)</h4>
    <div class="video-container">
          <iframe
      width="100%"
      height="315"
      src="https://www.youtube.com/embed/DYZyQ-DVkvU"
      title="반려동물 응급상황 대처방법"
      frameborder="0"
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
      allowfullscreen>
     </iframe>
    </div>
    <p class="video-caption">
    긴급 상황 시 설문 응답을 기다릴 수 없는 분들을 위해, 믿을 수 있는 채널의 응급 대처 영상을 바로 제공합니다.
    </p>
   </div>
     </section>

  <footer class="footer">
   <small>© 반려친구 긴급케어 · 설문용 데모 페이지</small>
  </footer>
 </main>

 <script src="script.js"></script>
<script id="jsbin-javascript">
document.addEventListener("DOMContentLoaded", () => {
 // Google Apps Script URL (고객님 링크 유지)
 const API_URL = 'https://script.google.com/macros/s/AKfycbzd7atjDCME61bCi_7TuToK6CNZxckI7bqReZt6p7b_oq6TRW_TiwbQGlLWnlsXihRJDA/exec';

 const form = document.getElementById("petSurveyForm");
 const msg = document.getElementById("msg");
 const submissionsList = document.getElementById("submissionsList");
 const regionOtherInput = document.querySelector('input[name="regionOther"]');
 const tabBtns = document.querySelectorAll(".tab-btn");

 let localSubmissions = []; // 서버에서 불러온 전체 데이터

 // ⭐️ 1. 핵심 수정: Sheets의 실제 열 이름 (Mood, Content, Reaction)을 Key로 사용 ⭐️
 // Sheets에서 이 이름으로 데이터를 읽어옵니다.
 const keyMap = {
  hasPet: "반려동물 보유",
  region: "지역",
  regionOther: "직접 입력 지역",
  Mood: "병원 선택 기준",      // Sheets 열 (폼: priorityCriteria)
  Content: "최대 지불 의향",    // Sheets 열 (폼: concernAndFeature)
  Reaction: "불만/필요 기능",   // Sheets 열 (폼: priceRange)
  priority1: "1순위 정보",
  priority2: "2순위 정보",
 };

 // ⭐️ 2. 표시할 3개 핵심 항목을 Sheets의 열 이름으로 정의 ⭐️
 const displayKeys = ["Mood", "Reaction"];

 /**
 * 1. 서버에서 최신 데이터를 가져와 localSubmissions를 갱신하고, 화면을 다시 그리는 핵심 함수
 */
 const fetchSubmissions = async () => {
  try {
   const uniqueApiUrl = `${API_URL}?t=${new Date().getTime()}`;
   submissionsList.innerHTML = '<div class="placeholder">제출된 기록을 불러오는 중입니다...</div>';

   const res = await fetch(uniqueApiUrl);
   if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
  
   const data = await res.json();
  
   if (Array.isArray(data)) {
    localSubmissions = data;
    renderSubmissions(); // 목록 갱신
   } else {
    submissionsList.innerHTML = '<div class="placeholder">데이터 로딩 실패: 서버 응답 형식이 올바르지 않습니다.</div>';
   }
  } catch (error) {
   console.error("서버 데이터 로딩 오류:", error);
   submissionsList.innerHTML = '<div class="placeholder">네트워크 오류 또는 서버 오류로 데이터를 불러올 수 없습니다.</div>';
  }
 };


 // 2. 폼 제출 (POST 후, 전체 데이터 재요청 로직 포함)
 form.addEventListener("submit", async (e) => {
  e.preventDefault();
  msg.textContent = "✅ 제출 중...";

  const data = new FormData(form);
  const payload = {};
  for (const [k, v] of data.entries()) payload[k] = v;

  try {
   await fetch(API_URL, {
    method: 'POST',
    mode: 'no-cors',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(payload)
   });

   msg.textContent = "💌 제출이 완료되었습니다! 의견 목록을 갱신합니다.";
  
   await fetchSubmissions();

   form.reset();
   regionOtherInput.style.display = "none";
  
   // '다른 사람 의견 보기' 탭으로 자동 전환 및 활성화
   document.querySelector('.tab-btn[data-target="submissions"]').click();

  } catch (error) {
   msg.textContent = "⚠️ 서버 응답 오류 발생. 데이터 갱신을 시도합니다.";
   await fetchSubmissions();
   document.querySelector('.tab-btn[data-target="submissions"]').click();
  }
 });

 // 3. submissions 렌더링
 const renderSubmissions = () => {
  submissionsList.innerHTML = "";
 
  if (localSubmissions.length === 0) {
    submissionsList.innerHTML = '<div class="placeholder">아직 제출된 기록이 없습니다.</div>';
    return;
  }
 
  // 중복 렌더링 방지 및 최신 10개만 표시 (slice().reverse().slice(0, 10))
  localSubmissions.slice().reverse().slice(0, 10).forEach((sub, index) => {
   const card = document.createElement("div");
   card.className = "record fade-in";
   card.style.setProperty('--delay', `${index * 0.05}s`);

   // ⭐️ displayKeys(Mood, Content, Reaction)만 순회하며 렌더링
   let html = displayKeys
     .map(k => {
       // keyMap에서 Sheets 열 이름(k)에 맞는 레이블을 가져옵니다.
       const label = keyMap[k];
       let value = sub[k]; // Sheets에서 읽어온 값
      
       // ⭐️ 레거시 맵을 제거했습니다. GAS에서 데이터가 올바르게 기록되므로 필요 없습니다. ⭐️
      
       // 최종 값이 없거나 빈 문자열이면 "응답 없음"을 표시
       const displayValue = (value && value !== "" && value !== " ") ? value : "응답 없음";
      
       // 스타일링 코드 유지
       return `<div class="record-item">
         <strong>${label}:</strong>
         <span class="${displayValue === '응답 없음' ? 'text-muted' : 'text-accent'}">${displayValue}</span>
        </div>`;
     })
    .join("");
   
   if (!html) html = "<div>제출된 정보 없음</div>";
   card.innerHTML = html;
   submissionsList.appendChild(card);
  });
 };

 // 4. 탭 클릭 이벤트 (기존 유지)
 tabBtns.forEach(btn => {
  btn.addEventListener("click", () => {
   tabBtns.forEach(b => b.classList.remove("active"));
   document.querySelectorAll(".tab-panel").forEach(p => p.classList.remove("active"));
  
   btn.classList.add("active");
   document.getElementById(btn.dataset.target).classList.add("active");

   // submissions 탭이 활성화될 때만 fetchSubmissions 호출
   if (btn.dataset.target === "submissions") {
    fetchSubmissions();
   }
  });
 });

 // 5. "기타" 입력 토글 (기존 유지)
 document.querySelectorAll('input[name="region"]').forEach(radio => {
  radio.addEventListener('change', () => {
   if (radio.value === "기타") {
    regionOtherInput.style.display = "block";
    regionOtherInput.required = true;
   } else {
    regionOtherInput.style.display = "none";
    regionOtherInput.required = false;
   }
  });
 });

});
</script>
</body>
</html>

